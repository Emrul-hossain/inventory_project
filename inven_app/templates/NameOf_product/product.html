{% extends 'base.html' %}

{% block main %}
<div class="container mt-4">
    <div class="card">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <span>Product</span>
            <a href="{% url 'Addproduct' %}" class="btn btn-light btn-sm"> Add New</a>
        </div>
        <div class="card-body">
           <form method="get" class="row g-3 mb-4">
        <div class="col-md-3">
            {{ form.product_type }}
        </div>
        <div class="col-md-3">
            {{ form.product_name }}
            <div id="suggestions" class="list-group position-absolute w-50" style="z-index:1000;"></div>
        </div>
        <div class="col-md-3">
              {{ form.is_raw_material}}
            <label class="form-check-label" for="{{ form.is_raw_material.id_for_label }}"> 
            {{ form.is_raw_material.label }}
            
        </div>
        <div class="col-md-3">
            <button type="submit" class="btn btn-primary w-100">Search</button>
        </div>
    </form>

            <!-- Table -->
            <div class="table-responsive">
                <table class="table table-bordered table-striped text-center align-middle">
                    <thead class="table-primary">
                        <tr>
                            <th>Product Name</th>
                            <th>Type Name</th>
                            <th>Size</th>
                            <th>Category</th>
                            <th>Color Name</th>
                            <th>Pack Size</th>
                            <th>Reorder Quantity</th>
                            <th>Sequence</th>
                            <th>Is Raw Material</th>
                            <th>Action</th>
                            
                        </tr>
                    </thead>
                    <tbody>
                        {% for i in products%}
                        <tr>
                            <td>{{i.Product_Name}}</td>
                            <td>{{i.Type_Name}}</td>
                            <td>{{i.Size}}</td>
                            <td>{{i.Category}}</td>
                            <td>{{i.Color_Name}}</td>
                            <td>{{i.Pack_Size}}</td>
                            <td>{{i.Reorder_Quantity}}</td>
                            <td>{{i.Sequence}}</td>
                            <td>
                                {% if i.Is_Raw_Material %}
                                    True
                                {% else %}
                                    False
                                {% endif %}
                            </td>   
                            <td>
                                <a href="{% url 'update_p' i.id %}" class="text-success me-2">
                                    <i class="bi bi-pencil-square"></i>
                                </a>
                                <a href="{% url 'delete_p' i.id %}" class="text-danger">
                                <i class="bi bi-x-square"></i>
                                </a>
                            </td>

                        </tr>
                        {% endfor %}
                       
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <nav>
                <ul class="pagination justify-content-center mt-3">
                    <li class="page-item disabled"><a class="page-link" href="#">«</a></li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item"><a class="page-link" href="#">»</a></li>
                </ul>
            </nav>
        </div>
    </div>
</div>

<!-- Bootstrap icons CDN -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<script>
document.addEventListener("DOMContentLoaded", function() {
    const searchInput = document.getElementById('product-search');
    const suggestionBox = document.getElementById('suggestions');

    if (!searchInput) return; 

    searchInput.addEventListener('input', function() {
        const query = this.value;
        if(query.length > 0){
            fetch(`/products-autocomplete/?term=${query}`)
            .then(response => response.json())
            .then(data => {
                suggestionBox.innerHTML = '';
                data.forEach(item => {
                    const div = document.createElement('div');
                    div.classList.add('list-group-item', 'list-group-item-action');
                    div.textContent = item;

                    
                    div.addEventListener('click', () => {
                        searchInput.value = item;
                        suggestionBox.innerHTML = '';
                    });

                    suggestionBox.appendChild(div);
                });
            });
        } else {
            suggestionBox.innerHTML = '';
        }
    });
});
</script>



{% endblock  %}